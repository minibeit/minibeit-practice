{"id":"WdSo","dependencies":[{"name":"/Users/ivan/Projects/recoil-persist/tsconfig.json","includedInParent":true,"mtime":1613508796676},{"name":"/Users/ivan/Projects/recoil-persist/package.json","includedInParent":true,"mtime":1613510229226}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.recoilPersist=void 0;const e=(e={})=>{if(\"undefined\"==typeof window)return{persistAtom:()=>{}};const{key:t=\"recoil-persist\",storage:r=localStorage}=e,o=()=>{const e=r.getItem(t);return null==e?{}:\"string\"==typeof e?n(e):\"function\"==typeof e.then?e.then(n):{}},n=e=>{if(void 0===e)return{};try{return JSON.parse(e)}catch(t){return console.error(t),{}}},s=e=>{try{r.setItem(t,JSON.stringify(e))}catch(o){console.error(o)}};return{persistAtom:({onSet:e,node:t,trigger:r,setSelf:n})=>{if(\"get\"===r){const e=o();\"function\"==typeof e.then&&e.then(e=>{e.hasOwnProperty(t.key)&&n(e[t.key])}),e.hasOwnProperty(t.key)&&n(e[t.key])}e(async e=>{const r=await o();\"DefaultValue\"===e.__tag&&r.hasOwnProperty(t.key)?delete r[t.key]:r[t.key]=e,s(r)})}}};exports.recoilPersist=e;"},"sourceMaps":{"js":{"mappings":[{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":1,"column":0}},{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":1,"column":13}},{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":1,"column":20}},{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":1,"column":35}},{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":1,"column":43}},{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":1,"column":56}},{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":1,"column":57}},{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":1,"column":64}},{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":1,"column":68}},{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":1,"column":76}},{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":1,"column":95}},{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":7},"generated":{"line":1,"column":97}},{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":1,"column":103}},{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":29},"generated":{"line":1,"column":105}},{"source":"../../src/index.ts","name":null,"original":{"line":22,"column":2},"generated":{"line":1,"column":106}},{"source":"../../src/index.ts","name":null,"original":{"line":22,"column":33},"generated":{"line":1,"column":108}},{"source":"../../src/index.ts","name":null,"original":{"line":24,"column":6},"generated":{"line":1,"column":114}},{"source":"../../src/index.ts","name":null,"original":{"line":24,"column":24},"generated":{"line":1,"column":117}},{"source":"../../src/index.ts","name":null,"original":{"line":24,"column":13},"generated":{"line":1,"column":137}},{"source":"../../src/index.ts","name":null,"original":{"line":25,"column":11},"generated":{"line":1,"column":144}},{"source":"../../src/index.ts","name":null,"original":{"line":25,"column":11},"generated":{"line":1,"column":150}},{"source":"../../src/index.ts","name":null,"original":{"line":26,"column":6},"generated":{"line":1,"column":151}},{"source":"../../src/index.ts","name":null,"original":{"line":26,"column":19},"generated":{"line":1,"column":163}},{"source":"../../src/index.ts","name":null,"original":{"line":30,"column":8},"generated":{"line":1,"column":171}},{"source":"../../src/index.ts","name":null,"original":{"line":30,"column":8},"generated":{"line":1,"column":177}},{"source":"../../src/index.ts","name":null,"original":{"line":30,"column":10},"generated":{"line":1,"column":181}},{"source":"../../src/index.ts","name":null,"original":{"line":30,"column":16},"generated":{"line":1,"column":183}},{"source":"../../src/index.ts","name":null,"original":{"line":30,"column":8},"generated":{"line":1,"column":200}},{"source":"../../src/index.ts","name":null,"original":{"line":30,"column":34},"generated":{"line":1,"column":208}},{"source":"../../src/index.ts","name":null,"original":{"line":30,"column":44},"generated":{"line":1,"column":210}},{"source":"../../src/index.ts","name":null,"original":{"line":30,"column":61},"generated":{"line":1,"column":224}},{"source":"../../src/index.ts","name":null,"original":{"line":59,"column":8},"generated":{"line":1,"column":226}},{"source":"../../src/index.ts","name":null,"original":{"line":59,"column":19},"generated":{"line":1,"column":228}},{"source":"../../src/index.ts","name":null,"original":{"line":60,"column":10},"generated":{"line":1,"column":233}},{"source":"../../src/index.ts","name":null,"original":{"line":60,"column":10},"generated":{"line":1,"column":239}},{"source":"../../src/index.ts","name":null,"original":{"line":60,"column":20},"generated":{"line":1,"column":241}},{"source":"../../src/index.ts","name":null,"original":{"line":60,"column":28},"generated":{"line":1,"column":243}},{"source":"../../src/index.ts","name":null,"original":{"line":60,"column":36},"generated":{"line":1,"column":251}},{"source":"../../src/index.ts","name":null,"original":{"line":61,"column":8},"generated":{"line":1,"column":254}},{"source":"../../src/index.ts","name":null,"original":{"line":61,"column":8},"generated":{"line":1,"column":261}},{"source":"../../src/index.ts","name":null,"original":{"line":61,"column":8},"generated":{"line":1,"column":267}},{"source":"../../src/index.ts","name":null,"original":{"line":62,"column":13},"generated":{"line":1,"column":269}},{"source":"../../src/index.ts","name":null,"original":{"line":64,"column":27},"generated":{"line":1,"column":272}},{"source":"../../src/index.ts","name":null,"original":{"line":64,"column":15},"generated":{"line":1,"column":289}},{"source":"../../src/index.ts","name":null,"original":{"line":65,"column":13},"generated":{"line":1,"column":291}},{"source":"../../src/index.ts","name":null,"original":{"line":65,"column":24},"generated":{"line":1,"column":293}},{"source":"../../src/index.ts","name":null,"original":{"line":67,"column":32},"generated":{"line":1,"column":296}},{"source":"../../src/index.ts","name":null,"original":{"line":67,"column":15},"generated":{"line":1,"column":315}},{"source":"../../src/index.ts","name":null,"original":{"line":67,"column":23},"generated":{"line":1,"column":317}},{"source":"../../src/index.ts","name":null,"original":{"line":68,"column":13},"generated":{"line":1,"column":322}},{"source":"../../src/index.ts","name":null,"original":{"line":68,"column":21},"generated":{"line":1,"column":324}},{"source":"../../src/index.ts","name":null,"original":{"line":68,"column":26},"generated":{"line":1,"column":329}},{"source":"../../src/index.ts","name":null,"original":{"line":71,"column":11},"generated":{"line":1,"column":332}},{"source":"../../src/index.ts","name":null,"original":{"line":74,"column":8},"generated":{"line":1,"column":336}},{"source":"../../src/index.ts","name":null,"original":{"line":74,"column":22},"generated":{"line":1,"column":338}},{"source":"../../src/index.ts","name":null,"original":{"line":75,"column":8},"generated":{"line":1,"column":342}},{"source":"../../src/index.ts","name":null,"original":{"line":75,"column":18},"generated":{"line":1,"column":350}},{"source":"../../src/index.ts","name":null,"original":{"line":75,"column":8},"generated":{"line":1,"column":354}},{"source":"../../src/index.ts","name":null,"original":{"line":76,"column":13},"generated":{"line":1,"column":356}},{"source":"../../src/index.ts","name":null,"original":{"line":76,"column":13},"generated":{"line":1,"column":362}},{"source":"../../src/index.ts","name":null,"original":{"line":78,"column":8},"generated":{"line":1,"column":365}},{"source":"../../src/index.ts","name":null,"original":{"line":79,"column":13},"generated":{"line":1,"column":369}},{"source":"../../src/index.ts","name":null,"original":{"line":79,"column":13},"generated":{"line":1,"column":376}},{"source":"../../src/index.ts","name":null,"original":{"line":79,"column":18},"generated":{"line":1,"column":381}},{"source":"../../src/index.ts","name":null,"original":{"line":79,"column":24},"generated":{"line":1,"column":387}},{"source":"../../src/index.ts","name":null,"original":{"line":80,"column":6},"generated":{"line":1,"column":390}},{"source":"../../src/index.ts","name":null,"original":{"line":80,"column":13},"generated":{"line":1,"column":396}},{"source":"../../src/index.ts","name":null,"original":{"line":82,"column":13},"generated":{"line":1,"column":399}},{"source":"../../src/index.ts","name":null,"original":{"line":81,"column":6},"generated":{"line":1,"column":406}},{"source":"../../src/index.ts","name":null,"original":{"line":81,"column":14},"generated":{"line":1,"column":414}},{"source":"../../src/index.ts","name":null,"original":{"line":81,"column":20},"generated":{"line":1,"column":420}},{"source":"../../src/index.ts","name":null,"original":{"line":82,"column":13},"generated":{"line":1,"column":423}},{"source":"../../src/index.ts","name":null,"original":{"line":86,"column":8},"generated":{"line":1,"column":428}},{"source":"../../src/index.ts","name":null,"original":{"line":86,"column":20},"generated":{"line":1,"column":430}},{"source":"../../src/index.ts","name":null,"original":{"line":87,"column":8},"generated":{"line":1,"column":434}},{"source":"../../src/index.ts","name":null,"original":{"line":90,"column":6},"generated":{"line":1,"column":438}},{"source":"../../src/index.ts","name":null,"original":{"line":90,"column":14},"generated":{"line":1,"column":440}},{"source":"../../src/index.ts","name":null,"original":{"line":90,"column":22},"generated":{"line":1,"column":448}},{"source":"../../src/index.ts","name":null,"original":{"line":90,"column":27},"generated":{"line":1,"column":450}},{"source":"../../src/index.ts","name":null,"original":{"line":90,"column":32},"generated":{"line":1,"column":455}},{"source":"../../src/index.ts","name":null,"original":{"line":90,"column":42},"generated":{"line":1,"column":465}},{"source":"../../src/index.ts","name":null,"original":{"line":91,"column":6},"generated":{"line":1,"column":469}},{"source":"../../src/index.ts","name":null,"original":{"line":91,"column":13},"generated":{"line":1,"column":475}},{"source":"../../src/index.ts","name":null,"original":{"line":92,"column":6},"generated":{"line":1,"column":478}},{"source":"../../src/index.ts","name":null,"original":{"line":92,"column":14},"generated":{"line":1,"column":486}},{"source":"../../src/index.ts","name":null,"original":{"line":92,"column":20},"generated":{"line":1,"column":492}},{"source":"../../src/index.ts","name":null,"original":{"line":96,"column":9},"generated":{"line":1,"column":497}},{"source":"../../src/index.ts","name":null,"original":{"line":96,"column":9},"generated":{"line":1,"column":503}},{"source":"../../src/index.ts","name":null,"original":{"line":96,"column":11},"generated":{"line":1,"column":504}},{"source":"../../src/index.ts","name":null,"original":{"line":32,"column":39},"generated":{"line":1,"column":516}},{"source":"../../src/index.ts","name":null,"original":{"line":32,"column":42},"generated":{"line":1,"column":518}},{"source":"../../src/index.ts","name":null,"original":{"line":32,"column":42},"generated":{"line":1,"column":524}},{"source":"../../src/index.ts","name":null,"original":{"line":32,"column":49},"generated":{"line":1,"column":526}},{"source":"../../src/index.ts","name":null,"original":{"line":32,"column":49},"generated":{"line":1,"column":531}},{"source":"../../src/index.ts","name":null,"original":{"line":32,"column":55},"generated":{"line":1,"column":533}},{"source":"../../src/index.ts","name":null,"original":{"line":32,"column":55},"generated":{"line":1,"column":541}},{"source":"../../src/index.ts","name":null,"original":{"line":32,"column":64},"generated":{"line":1,"column":543}},{"source":"../../src/index.ts","name":null,"original":{"line":32,"column":64},"generated":{"line":1,"column":551}},{"source":"../../src/index.ts","name":null,"original":{"line":33,"column":8},"generated":{"line":1,"column":557}},{"source":"../../src/index.ts","name":null,"original":{"line":33,"column":20},"generated":{"line":1,"column":560}},{"source":"../../src/index.ts","name":null,"original":{"line":33,"column":8},"generated":{"line":1,"column":568}},{"source":"../../src/index.ts","name":null,"original":{"line":33,"column":27},"generated":{"line":1,"column":570}},{"source":"../../src/index.ts","name":null,"original":{"line":34,"column":12},"generated":{"line":1,"column":571}},{"source":"../../src/index.ts","name":null,"original":{"line":34,"column":12},"generated":{"line":1,"column":577}},{"source":"../../src/index.ts","name":null,"original":{"line":34,"column":20},"generated":{"line":1,"column":579}},{"source":"../../src/index.ts","name":null,"original":{"line":35,"column":32},"generated":{"line":1,"column":583}},{"source":"../../src/index.ts","name":null,"original":{"line":35,"column":17},"generated":{"line":1,"column":602}},{"source":"../../src/index.ts","name":null,"original":{"line":35,"column":23},"generated":{"line":1,"column":604}},{"source":"../../src/index.ts","name":null,"original":{"line":36,"column":8},"generated":{"line":1,"column":610}},{"source":"../../src/index.ts","name":null,"original":{"line":36,"column":14},"generated":{"line":1,"column":612}},{"source":"../../src/index.ts","name":null,"original":{"line":36,"column":20},"generated":{"line":1,"column":617}},{"source":"../../src/index.ts","name":null,"original":{"line":37,"column":14},"generated":{"line":1,"column":621}},{"source":"../../src/index.ts","name":null,"original":{"line":37,"column":16},"generated":{"line":1,"column":623}},{"source":"../../src/index.ts","name":null,"original":{"line":37,"column":31},"generated":{"line":1,"column":638}},{"source":"../../src/index.ts","name":null,"original":{"line":37,"column":36},"generated":{"line":1,"column":640}},{"source":"../../src/index.ts","name":null,"original":{"line":38,"column":12},"generated":{"line":1,"column":646}},{"source":"../../src/index.ts","name":null,"original":{"line":38,"column":20},"generated":{"line":1,"column":648}},{"source":"../../src/index.ts","name":null,"original":{"line":38,"column":22},"generated":{"line":1,"column":650}},{"source":"../../src/index.ts","name":null,"original":{"line":38,"column":27},"generated":{"line":1,"column":652}},{"source":"../../src/index.ts","name":null,"original":{"line":42,"column":10},"generated":{"line":1,"column":660}},{"source":"../../src/index.ts","name":null,"original":{"line":42,"column":16},"generated":{"line":1,"column":662}},{"source":"../../src/index.ts","name":null,"original":{"line":42,"column":31},"generated":{"line":1,"column":677}},{"source":"../../src/index.ts","name":null,"original":{"line":42,"column":36},"generated":{"line":1,"column":679}},{"source":"../../src/index.ts","name":null,"original":{"line":43,"column":8},"generated":{"line":1,"column":685}},{"source":"../../src/index.ts","name":null,"original":{"line":43,"column":16},"generated":{"line":1,"column":687}},{"source":"../../src/index.ts","name":null,"original":{"line":43,"column":22},"generated":{"line":1,"column":689}},{"source":"../../src/index.ts","name":null,"original":{"line":43,"column":27},"generated":{"line":1,"column":691}},{"source":"../../src/index.ts","name":null,"original":{"line":47,"column":4},"generated":{"line":1,"column":697}},{"source":"../../src/index.ts","name":null,"original":{"line":47,"column":10},"generated":{"line":1,"column":699}},{"source":"../../src/index.ts","name":null,"original":{"line":47,"column":10},"generated":{"line":1,"column":705}},{"source":"../../src/index.ts","name":null,"original":{"line":48,"column":12},"generated":{"line":1,"column":709}},{"source":"../../src/index.ts","name":null,"original":{"line":48,"column":12},"generated":{"line":1,"column":715}},{"source":"../../src/index.ts","name":null,"original":{"line":48,"column":26},"generated":{"line":1,"column":723}},{"source":"../../src/index.ts","name":null,"original":{"line":49,"column":29},"generated":{"line":1,"column":727}},{"source":"../../src/index.ts","name":null,"original":{"line":49,"column":10},"generated":{"line":1,"column":744}},{"source":"../../src/index.ts","name":null,"original":{"line":49,"column":19},"generated":{"line":1,"column":746}},{"source":"../../src/index.ts","name":null,"original":{"line":49,"column":47},"generated":{"line":1,"column":753}},{"source":"../../src/index.ts","name":null,"original":{"line":49,"column":53},"generated":{"line":1,"column":755}},{"source":"../../src/index.ts","name":null,"original":{"line":49,"column":68},"generated":{"line":1,"column":770}},{"source":"../../src/index.ts","name":null,"original":{"line":49,"column":73},"generated":{"line":1,"column":772}},{"source":"../../src/index.ts","name":null,"original":{"line":50,"column":15},"generated":{"line":1,"column":784}},{"source":"../../src/index.ts","name":null,"original":{"line":50,"column":21},"generated":{"line":1,"column":786}},{"source":"../../src/index.ts","name":null,"original":{"line":50,"column":26},"generated":{"line":1,"column":788}},{"source":"../../src/index.ts","name":null,"original":{"line":52,"column":8},"generated":{"line":1,"column":793}},{"source":"../../src/index.ts","name":null,"original":{"line":52,"column":14},"generated":{"line":1,"column":795}},{"source":"../../src/index.ts","name":null,"original":{"line":52,"column":19},"generated":{"line":1,"column":797}},{"source":"../../src/index.ts","name":null,"original":{"line":52,"column":26},"generated":{"line":1,"column":802}},{"source":"../../src/index.ts","name":null,"original":{"line":55,"column":6},"generated":{"line":1,"column":804}},{"source":"../../src/index.ts","name":null,"original":{"line":55,"column":15},"generated":{"line":1,"column":806}},{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":1,"column":814}},{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":13},"generated":{"line":1,"column":822}},{"source":"../../src/index.ts","name":null,"original":{"line":21,"column":26},"generated":{"line":1,"column":836}}],"sources":{"../../src/index.ts":"import { AtomEffect } from 'recoil'\n\nexport interface PersistStorage {\n  setItem(key: string, value: string): void | Promise<void>\n\n  getItem(key: string): null | string | Promise<string>\n}\n\nexport interface PersistConfiguration {\n  key?: string\n  storage?: PersistStorage\n}\n\n/**\n * Recoil module to persist state to storage\n *\n * @param config Optional configuration object\n * @param config.key Used as key in local storage, defaults to `recoil-persist`\n * @param config.storage Local storage to use, defaults to `localStorage`\n */\nexport const recoilPersist = (\n  config: PersistConfiguration = {},\n): { persistAtom: AtomEffect<any> } => {\n  if (typeof window === 'undefined') {\n    return {\n      persistAtom: () => {},\n    }\n  }\n\n  const { key = 'recoil-persist', storage = localStorage } = config\n\n  const persistAtom: AtomEffect<any> = ({ onSet, node, trigger, setSelf }) => {\n    if (trigger === 'get') {\n      const state = getState()\n      if (typeof state.then === 'function') {\n        state.then((s) => {\n          if (s.hasOwnProperty(node.key)) {\n            setSelf(s[node.key])\n          }\n        })\n      }\n      if (state.hasOwnProperty(node.key)) {\n        setSelf(state[node.key])\n      }\n    }\n\n    onSet(async (newValue) => {\n      const state = await getState()\n      if (newValue.__tag === 'DefaultValue' && state.hasOwnProperty(node.key)) {\n        delete state[node.key]\n      } else {\n        state[node.key] = newValue\n      }\n\n      setState(state)\n    })\n  }\n\n  const getState = (): any => {\n    const toParse = storage.getItem(key)\n    if (toParse === null || toParse === undefined) {\n      return {}\n    }\n    if (typeof toParse === 'string') {\n      return parseState(toParse)\n    }\n    if (typeof toParse.then === 'function') {\n      return toParse.then(parseState)\n    }\n\n    return {}\n  }\n\n  const parseState = (state: string) => {\n    if (state === undefined) {\n      return {}\n    }\n    try {\n      return JSON.parse(state)\n    } catch (e) {\n      console.error(e)\n      return {}\n    }\n  }\n\n  const setState = (state: any): void => {\n    try {\n      //TODO for React Native `AsyncStorage`, we should be using `mergeItem`\n      // to merge existing stringified object with new one\n      storage.setItem(key, JSON.stringify(state))\n    } catch (e) {\n      console.error(e)\n    }\n  }\n\n  return { persistAtom }\n}\n"},"lineCount":null}},"error":null,"hash":"72a8a9bd451af7c1cc070be4026cfede","cacheData":{"env":{}}}